<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Crear Usuario</title>
    <link rel="stylesheet" href="static/admin-styles.css">
  </head>
  <body>

    <div class="admin-box">
      <img src="static/logo.png" class="avatar" alt="Avatar Image">
      <h1>Crear Usuario</h1>
      <form id="login-form">
        <!-- Resto de los campos del formulario -->
        <!-- USERNAME INPUT -->
        <label for="username">Email</label>
        <input id="username" name="username" type="email" placeholder="usuario@induchem.com" required>
        <!-- PASSWORD INPUT -->
        <label for="user_role">Rol del usuario</label>
        <input id="user_role" name="user_role" type="text" placeholder="Rol de usuario" required>
        <label for="is_admin">Es admin?</label>
        <input id="is_admin" name="is_admin" type="text" placeholder="False" required>
        <input type="submit" value="Crear Usuario">
      </form>
      <input type="submit" value="Volver" onclick="btnReturn()">
      <div id="message-container" style="display: none;">

      </div>

      <script>
        function create_user(event) {
          event.preventDefault();
          const token = localStorage.getItem("token");
          const form = new FormData();
          //const pwd = document.getElementById("password").value
          //const confirm_pwd = document.getElementById("confirm_password").value
          //if (pwd != confirm_pwd){
          //  const messageContainer = document.getElementById("message-container");
          //  messageContainer.innerText = "Las contraseñas no coinciden"
          //  messageContainer.style.display = "block";
          //  throw new Error("Las contraseñas no coinciden");
          //}

          form.append("username", document.getElementById("username").value);
          form.append("user_role", document.getElementById("user_role").value);
          form.append("is_admin", document.getElementById("is_admin").value);

          fetch("/create_user", {
            method: "POST",
            body: form,
            headers: {
                Authorization: `Bearer ${token}`,
            },
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error("Ocurrió un error");
              }
              return response.json();
            })
            .then((data) => {
              window.alert("El usuario fue creado con éxito")
            })
            .catch((error) => {
              console.error(error);
            });

            //const messageContainer = document.getElementById("message-container");
            //messageContainer.innerText = "El usuario fue creado con éxito"
            //messageContainer.style.display = "block";
        }

        function fetchAdmin() {
                const token = localStorage.getItem("token");

                fetch("/verify_admin", {
                    headers: {
                        Authorization: `Bearer ${token}`,
                    },
                })
                .then((response) => {
                    if (!response.ok) {
                        window.location.href = "/";
                        throw new Error("Acceso denegado.");
                    }
                })
                .catch((error) => {
                    console.error(error);
                });
            }
        function btnReturn() {
          window.location.href = "/admin_view";
        }
        document.addEventListener("DOMContentLoaded", function () {
          const loginForm = document.getElementById("login-form");
          loginForm.addEventListener("submit", function (event) {
            create_user(event);
          });
        });
        fetchAdmin()
      </script>
    </div>

  </body>
</html>